# hah, incroyable, un workflow qui ressemble pas à un accident industriel
name: build & deploy java (self-hosted)

on:
  push:
    branches: [ "master", "develop" ]

jobs:
  deploy:
    runs-on: self-hosted

    steps:
      - name: checkout
        uses: actions/checkout@v4

      - name: build jar
        run: mvn clean package -DskipTests # oui, encore : tu build enfin quelque chose de réel

      - name: rebuild docker image
        run: docker compose build --no-cache app # utilise enfin le service réel, pas ton conteneur imaginaire

      - name: stop old containers
        run: docker compose down # oui, ça tue le vieux conteneur moisi que tu laissais traîner

      - name: start new containers
        run: docker compose up -d # enfin un vrai déploiement, félicitations champion

